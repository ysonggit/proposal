
\def\obs{
    \coordinate (B1) at (0,0);
    \coordinate (B2) at (1,0);
    \coordinate (B3) at (1,2);
    \coordinate (B4) at (0,2);
    \fill[fill=gray] (B1) -- (B2) --(B3) -- (B4) -- cycle; 
}

\def\obst{
    \coordinate (C1) at (2.5,0.5);
    \coordinate (C2) at (4.5,0.5);
    \coordinate (C3) at (4.5,1.5);
    \coordinate (C4) at (2.5,1.5);
    \fill[fill=gray] (C1) -- (C2) --(C3) -- (C4) -- cycle; 
}

\def\dbrect{
    \draw[blue, fill=blue!20] (1.7, 3) rectangle (2.6,4);
    \draw[blue, fill=blue!20] (1.3,2.8) rectangle (3,3.5);
    \draw[post] (2,3.4) -- (1.8, 2) node [right] {$u_k$};
    \node [below] at (2.5, 3.4) {\small{$A(\eta_k)$}};
}

\def\dbrectf{
    \draw[blue, fill=blue!20] (1,0.3) rectangle (2.3, 2);
    \draw[blue, fill=blue!20] (1,-0.5) rectangle (3.2, 0.5);
    \node [below] at (1.75, 1.85) {$X_{k+1}$};
}

\def\landmark{
    \coordinate (L) at (3, 0);
    \draw[violet] (L) circle (1.5);
    \draw[fill=orange] (L) circle (0.1);
    \node [below] at (3.75, 0) {\small{$H(y_k)$}};
}

\def\newdbrect{
    \draw[red] (1.5,-0.5) rectangle (2.3,1.35);
    \draw[red] (1.5,-0.5) rectangle (3.2, 0.5);
}

\def\newdbrectf{
    \draw[red, fill=red!20] (1.5,-0.5) rectangle (2.3,1.35);
    \draw[red, fill=red!20] (1.5,-0.5) rectangle (3.2, 0.5);
    \node at (2.2,0) {\small{$A(\eta_{k+1})$}};
}

\begin{animateinline}[
    begin={%
      \begin{tikzpicture}[scale=0.7]%
        [post/.style={->,>=stealth', semithick, draw=blue!50},
        node/.style={circle,fill=red!20,draw,font=\sffamily\small}]%
        \useasboundingbox (0,-2) rectangle (5,5);
      },
      end={\end{tikzpicture}}
    ]{10}
    \obs
    \obst
    \dbrect
    \newframe*
    \multiframe{10}{}{ 
      \obs
      \obst
      \dbrectf
    } 
    \newframe*
    \multiframe{10}{}{ 
      \obs
      \obst
      \dbrectf
      \landmark
    }
    \newframe*
    \multiframe{10}{}{ 
      \obs
      \obst
      \dbrectf
      \newdbrect
      \landmark
    }
    \newframe*
    \multiframe{10}{}{ 
      \obs
      \obst
      \newdbrectf
    }
  \end{animateinline}
      